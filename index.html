<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Meta Media Hub ‚Äî Compact (Smart Detection)</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="wrap">
    <div class="app">

      <div class="top">
        <div class="brand">
          <div class="logo">MM</div>
          <div>
            <h1>Meta Media Hub</h1>
            <div class="small">Compact single-page tools</div>
          </div>
        </div>

        <div class="top-right">
          <button id="themeToggle" class="theme-toggle" title="Toggle theme">üåô</button>
          <div id="statusText" class="small">Locked</div>
        </div>
      </div>

      <!-- PASSWORD MODAL -->
      <div id="pwModal" class="modal" style="display:flex">
        <div class="panel" style="max-width:480px;">
          <h3 style="margin:0 0 8px;color:var(--accent)">Enter Password</h3>
          <div class="small" style="margin-bottom:8px">Enter to unlock the Meta Media Hub</div>
          <input id="pwInput" class="input" type="password" placeholder="Password" />
          <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px;">
            <button id="pwBtn" class="btn">Unlock</button>
          </div>
          <p id="pwMsg" class="small" style="color:#ff8080;min-height:18px"></p>
        </div>
      </div>

      <!-- HOME -->
      <div id="home" class="home" style="display:none">
        <div class="card" id="btnImage">
          <div class="icon">üñºÔ∏è</div>
          <div class="title">IMAGE TOOLS</div>
          <div class="sub">Resize ‚Ä¢ Focus ‚Ä¢ Smart Centering ‚Ä¢ ZIP</div>
        </div>

        <div class="card" id="btnVideo">
          <div class="icon">üéûÔ∏è</div>
          <div class="title">VIDEO TOOLS</div>
          <div class="sub">Mute ‚Ä¢ Crop ‚Ä¢ Export MP4</div>
        </div>
      </div>

      <!-- IMAGE SECTION -->
      <div id="imageSection" class="section">
        <div class="center-column">

          <div class="section-head">
            <div>
              <h2 style="margin:0;color:var(--accent)">Image Tools (Compact)</h2>
              <div class="small">Drag & drop multiple images ‚Äî smart detection recommends best crop.</div>
            </div>
            <div><button id="backHomeFromImage" class="back">‚Üê Home</button></div>
          </div>

          <!-- Smart Banner -->
          <div id="smartBanner" class="smart-banner off" style="display:none">
            <div class="icon" id="bannerIcon">‚ö™</div>
            <div class="text" id="bannerText">Smart Human Detection status will appear here after uploading images.</div>
          </div>

          <div class="box" style="margin-top:10px">
            <div id="dropImage" class="dropzone">Click or drag & drop images here (multiple)</div>
            <input id="imageInput" type="file" accept="image/*" multiple>
            <div id="imageFileList" class="file-list">No files uploaded.</div>

            <div class="row" style="margin-top:10px">
              <input id="imgWidth" class="input" type="number" placeholder="Width (px)">
              <input id="imgHeight" class="input" type="number" placeholder="Height (px)">
            </div>

            <div class="controls">
              <label class="small">Quality</label>
              <input id="imgQuality" type="range" min="60" max="100" value="90">
              <div id="imgQualityVal" class="small">90%</div>

              <div style="flex:1"></div>

              <div id="imgAiToggle" class="ai-switch" title="Smart Human Detection (recommended)">
                <div class="switch-track"><div class="switch-ball"></div></div>
                <span class="label-off">Smart Human Detection: OFF</span>
                <span class="label-on">Smart Human Detection: ON</span>
              </div>
            </div>

            <div style="display:flex;gap:8px;margin-top:12px">
              <button id="imgPreviewBtn" class="btn ghost">Preview First</button>
              <button id="focusBtn" class="btn ghost">Manual Focus</button>
              <button id="imgProcessBtn" class="btn">Process & Download ZIP</button>
            </div>

            <div class="progress"><div id="imgProgress" class="progress-bar"></div></div>
            <div id="imgStatus" class="small" style="margin-top:8px">Ready.</div>
          </div>
        </div>
      </div>

      <!-- VIDEO SECTION -->
      <div id="videoSection" class="section">
        <div class="center-column">
          <div class="section-head">
            <div>
              <h2 style="margin:0;color:var(--accent)">Video Tools</h2>
              <div class="small">Mute or crop videos in browser</div>
            </div>
            <div><button id="backHomeFromVideo" class="back">‚Üê Home</button></div>
          </div>

          <div class="box">
            <div id="dropVideo" class="dropzone">Click or drag & drop a video (mp4/webm)</div>
            <input id="videoInput" type="file" accept="video/*">

            <div style="margin-top:10px" class="video-wrap" id="videoWrap">
              <video id="videoPreview" controls style="width:100%;height:auto;background:#000"></video>
            </div>

            <div class="controls" style="margin-top:8px">
              <button id="muteBtn" class="btn">Mute Video</button>
              <button id="drawCropBtn" class="btn ghost">Draw Crop</button>
              <button id="exportCropBtn" class="btn">Export Cropped Video</button>
            </div>

            <div class="progress"><div id="videoProgress" class="progress-bar"></div></div>
            <div id="videoStatus" class="small" style="margin-top:8px">No video loaded.</div>
            <div style="margin-top:8px">
              <label class="small">FFmpeg:</label>
              <span id="ffmpegStatus" class="small">idle</span>
            </div>
          </div>
        </div>
      </div>

      <footer>Created by Mukesh Yadav ‚Ä¢ META E-learning Team</footer>
    </div>
  </div>

  <!-- PREVIEW MODAL -->
  <div id="previewModal" class="modal" aria-hidden="true">
    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong id="previewTitle">Preview</strong>
        <button id="closePreview" class="back">Close</button>
      </div>

      <div class="preview-area" id="previewArea">
        <img id="beforeImg" alt="Before preview">
        <div class="after-layer" id="afterLayer"><img id="afterImg" alt="After preview"></div>
        <div class="handle" id="handle" role="separator" aria-orientation="horizontal"></div>
      </div>

      <div style="display:flex;justify-content:space-between;margin-top:8px">
        <div class="small">Drag handle to compare</div>
        <div class="small" id="previewInfo"></div>
      </div>
    </div>
  </div>

 <!-- FOCUS MODAL -->
<div id="focusModal" class="modal" aria-hidden="true">
  <div class="panel" style="max-width:820px">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div>
        <strong style="color:var(--accent)">Manual Focus</strong>
        <div class="small">Drag/resise the square to choose focus area (center used for crop).</div>
      </div>
      <button id="closeFocus" class="back">Close</button>
    </div>

    <div style="display:flex;gap:12px">
      <div class="focus-canvas" id="focusCanvas">
        <img id="focusPreview" alt="Focus preview">
        <div id="focusRect" class="focus-rect" style="display:none">
          <div class="focus-handle"></div>
        </div>
      </div>
    </div>

    <div style="display:flex;gap:8px;margin-top:8px;justify-content:flex-end">
      <select id="focusSelect" class="input" style="width:260px"></select>
      <button id="saveFocus" class="btn">Save Focus</button>
      <button id="clearFocus" class="btn ghost">Clear Focus</button>
    </div>
  </div>
</div>

<!-- ‚ñ†‚ñ†‚ñ† GITHUB SAFETY SHIELD ‚ñ†‚ñ†‚ñ†  -->
<script>
/* Prevent accidental GitHub suspension by verifying repo cleanliness */
(async () => {
  const USER = "Hrike-debug";       // <-- your username
  const REPO = "meta-media-hub";    // <-- your repo

  const safe = msg => console.log("%c‚úî SAFE:", "color:#4caf50;font-weight:bold", msg);
  const warn = msg => console.log("%c‚ö† WARNING:", "color:#ff9800;font-weight:bold", msg);

  async function check(url){
    try{
      const r = await fetch(url);
      return r.status === 200;
    }catch(e){
      return false;
    }
  }

  /* 1 ‚Äî Check if .github/workflows exists */
  const wfURL = `https://api.github.com/repos/${USER}/${REPO}/contents/.github/workflows`;
  const hasWF = await check(wfURL);

  if(hasWF){
    warn("Workflow folder FOUND: .github/workflows ‚Äî DELETE IT IMMEDIATELY or account may be restricted.");
  } else {
    safe("No workflow folder found. ‚úî You are safe.");
  }

  /* 2 ‚Äî Check if GitHub Actions is enabled */
  const actionsURL = `https://api.github.com/repos/${USER}/${REPO}/actions/permissions`;
  try{
    const res = await fetch(actionsURL);
    const data = await res.json();
    if(data && data.enabled_repositories === "none"){
      safe("GitHub Actions is disabled. ‚úî Good.");
    } else {
      warn("GitHub Actions appears ON ‚Äî turn OFF from: Settings ‚Üí Actions ‚Üí Disable.");
    }
  } catch(e){
    // ignore ‚Äî GitHub may restrict API rate
  }
})();
</script>
<!-- ‚ñ†‚ñ†‚ñ† END SHIELD ‚ñ†‚ñ†‚ñ† -->

<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2/dist/coco-ssd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js"></script>
<script src="script.js"></script>
<!-- ‚ñ†‚ñ†‚ñ† GITHUB SAFETY SHIELD ‚Äî AUTO DELETE WORKFLOWS ‚ñ†‚ñ†‚ñ† -->
<style>
  #gh-shield-banner {
    width: 100%;
    padding: 14px;
    font-size: 15px;
    font-weight: 600;
    text-align: center;
    background: #b30000;
    color: white;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 99999;
    display: none;
    box-shadow: 0 2px 8px rgba(0,0,0,0.35);
  }
  #gh-shield-safe {
    width: 100%;
    padding: 10px;
    font-size: 13px;
    text-align: center;
    background: #0b7c00;
    color: #fff;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 99999;
    display: none;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  }
</style>

<div id="gh-shield-banner"></div>
<div id="gh-shield-safe">‚úì SAFE MODE: No workflows & GitHub Actions OFF.</div>

<script>
(async () => {
  const USER = "Hrike-debug";        // <-- your username
  const REPO = "meta-media-hub";     // <-- your repo

  const banner = document.getElementById("gh-shield-banner");
  const safeBanner = document.getElementById("gh-shield-safe");

  function showDanger(msg) {
    banner.textContent = msg;
    banner.style.display = "block";
  }

  function showSafe() {
    safeBanner.style.display = "block";
    setTimeout(() => safeBanner.style.display = "none", 3500);
  }

  async function api(path, method = "GET", body = null) {
    return fetch(`https://api.github.com/repos/${USER}/${REPO}/${path}`, {
      method,
      headers: { "Content-Type": "application/json" },
      body: body ? JSON.stringify(body) : null
    });
  }

  /** STEP 1 ‚Äî CHECK IF WORKFLOWS EXISTS */
  const wfCheck = await api("contents/.github/workflows");
  const hasWF = (wfCheck.status === 200);

  /** AUTO DELETE WORKFLOW FILES */
  async function autoDeleteWorkflows() {
    try {
      const contents = await wfCheck.json();

      for (const file of contents) {
        await api(`contents/${file.path}`, "DELETE", {
          message: "REMOVE WORKFLOW (auto-clean for safety)",
          sha: file.sha
        });
      }

      // remove empty folder if needed
      showDanger("‚ö† Workflows found and auto-deleted. Check repo to confirm.");
      console.warn("AUTO-DELETED workflow files.");
    } catch (e) {
      showDanger("‚ö† Workflows exist but auto-delete failed. Delete manually!");
      console.error("Delete failed:", e);
    }
  }

  if (hasWF) {
    showDanger("‚ö† WARNING: Workflows detected ‚Äî attempting auto-delete...");
    autoDeleteWorkflows();
  }

  /** STEP 2 ‚Äî CHECK IF ACTIONS ARE ENABLED */
  const actionsRes = await fetch(
    `https://api.github.com/repos/${USER}/${REPO}/actions/permissions`
  );
  const actionsData = await actionsRes.json();

  const actionsOff = actionsData.enabled_repositories === "none";

  if (!hasWF && actionsOff) {
    showSafe(); // You are fully clean
  }

  if (!actionsOff) {
    showDanger("‚ö† GitHub Actions ENABLED ‚Äî turn OFF (Settings ‚Üí Actions ‚Üí Disable)");
  }
})();
</script>

</body>
</html>
